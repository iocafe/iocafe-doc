
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Streaming data &#8212; iocafe 0.1 documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Two dictional memory blocks" href="200102-two-directional-memory-blocks.html" />
    <link rel="prev" title="Simple IO device code structure" href="200510-simple-io-device-application-structure.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="streaming-data">
<h1>Streaming data<a class="headerlink" href="#streaming-data" title="Permalink to this headline">¶</a></h1>
<p>The IOCOM uses flat memory blocks as basic abstraction, not streams. Still, configuration data, flash program updloads and video from camera are logically
stream type transfers. Ring buffer setup using IOCOM signals is used to transfer streamed data.</p>
<p>THIS PAGE IS OUTDATED, REVIEW!</p>
<p>Signals for camera stream transfer from IO device (&lt;- IO device)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="n">exp</span>

  <span class="n">cam_state</span>
  <span class="n">cam_buf</span>
  <span class="n">cam_head</span>

<span class="n">imp</span>

  <span class="n">cam_cmd</span>
  <span class="n">cam_select</span>
  <span class="n">cam_tail</span>
</pre></div>
</div>
<p>Signals for configuration file transfer to IO device (-&gt; IO device, tod = to device)
Used also for IO device flash program transfer .</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="n">conf_exp</span>

  <span class="n">tod_state</span>
  <span class="n">tod_tail</span>

<span class="n">conf_imp</span>

  <span class="n">tod_cmd</span>
  <span class="n">tod_select</span>
  <span class="n">tod_buf</span>

  <span class="n">tod_head</span>
</pre></div>
</div>
<p>Signals for configuration file transfer from IO device (&lt;- IO device, frd = from device)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="n">conf_exp</span>

  <span class="n">frd_state</span>
  <span class="n">frd_buf</span>
  <span class="n">frd_head</span>

<span class="n">conf_imp</span>

  <span class="n">frd_cmd</span>
  <span class="n">frd_select</span>
  <span class="n">frd_tail</span>
</pre></div>
</div>
<p>** Transfer from the IO device
controller:
Controller can be in IOC_STREAM_IDLE or IOC_STREAM_RUNNING command (in “cmd”)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre>If &quot;cmd&quot; is IOSTREAM_IDLE:
    If state is IOSTREAM_RUNNING, do nothing. We are waiting for IO device to finish.
    Otherwise if controller wants to start the transfer, set &quot;select&quot; to ? (app spefific), &quot;tail&quot; = 0 and &quot;cmd&quot; = IOSTREAM_RUNNING

if &quot;cmd&quot; is IOSTREAM_RUNNING:
    if &quot;state&quot; is IOC_STREAM_RUNNING or IOSTREAM_COMPLETED: Read all available data and move &quot;tail&quot;.
    If &quot;state&quot; is IOSTREAM_COMPLETED, the transfer has succesfully finished. Set &quot;cmd&quot; = IOSTREAM_IDLE.
    If controller wants to interrupt the transfer, set &quot;cmd&quot; = IOSTREAM_IDLE.
</pre></div>
</div>
<p>IO device:
Stream transfer has three states, IOC_STREAM_IDLE, IOC_STREAM_RUNNING and IOSTREAM_COMPLETED. This is in “state” signal.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre>If in IOC_STREAM_COMPLETED state:
    If &quot;cmd&quot; is not IOC_STREAM_RUNNING, set &quot;state&quot; = IOSTREAM_IDLE.

If in IOC_STREAM_IDLE state:
    If &quot;cmd&quot; is not IOC_STREAM_RUNNING, do nothing
    Otherwise set &quot;head&quot; to zero and switch to &quot;state&quot; = IOC_STREAM_RUNNING

If in IOC_STREAM_RUNNING state:
    If &quot;cmd&quot; is no longer IOSTREAM_RUNNING, interrupt the transfer and switch to &quot;state&quot; = IOC_STREAM_IDLE. Same if &quot;cmd&quot; signal is disconnected?
    Otherwise move as much data as we can to head position. Limits are how much data we have and how much space there is for data between tail and head.
    Update head position. &quot;select&quot; can choose what to transfer. If all data has been transferred, switch to &quot;state&quot; = IOC_STREAM_COMPLETED.
</pre></div>
</div>
<p>** Transfer to the IO device</p>
<p>controller:
Controller can be in IOC_STREAM_IDLE, IOC_STREAM_RUNNING or IOC_STREAM_COMPLETED command (in “cmd”)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre>If &quot;cmd&quot; is IOC_STREAM_IDLE:
    If &quot;state&quot; is not IOC_STREAM_IDLE, do nothing. We are waiting for IO device to finish.
    Otherwise if controller wants to start the transfer, set &quot;select&quot; to ? (app spefific), &quot;head&quot; = 0 and &quot;cmd&quot; = IOSTREAM_RUNNING

if &quot;cmd&quot; is IOC_STREAM_RUNNING:
    if &quot;state&quot; is IOC_STREAM_RUNNING: Write as much data to buffer as available and fits between tail and head and move head.
    If all data has been written and &quot;state&quot; is IOC_STREAM_RUNNING, set &quot;cmd&quot; to IOC_STREAM_COMPLETED.
    If controller want to interrupt the transfer, it sets &quot;cmd&quot; to IOC_STREAM_IDLE.

Is cmd is IOC_STREAM_COMPLETED:
    If &quot;state&quot; is IOC_STREAM_IDLE, set cmd = IOC_STREAM_IDLE. All done.
</pre></div>
</div>
<p>IO device:
Stream transfer has two states, IOC_STREAM_IDLE and IOC_STREAM_RUNNING. This is in “state” signal.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre>If in IOC_STREAM_IDLE state:
    If &quot;cmd&quot; is IOC_STREAM_IDLE, do nothing
    Otherwise set &quot;tail&quot; to zero and switch to &quot;state&quot; = IOC_STREAM_RUNNING

If in IOC_STREAM_RUNNING state:
    If &quot;cmd&quot; is IOC_STREAM_IDLE, the transfer has been interrupted: set &quot;state&quot; = IOC_STREAM_IDLE. Same if &quot;cmd&quot; signal is disconnected?
    Otherwise move as much data as we can from tail position, and update tail.
    if &quot;cmd&quot; is IOC_STREAM_COMPLETED, set &quot;state&quot; = IOC_STREAM_IDLE.
</pre></div>
</div>
<p>** Error handling note
This strem transfer doesn’t include any error handling, like if writing to flash fails. Use separate signals for error handling or
embed error information into stream. This is to keep stream transfer as simple as possible.</p>
<p>“state”</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="mi">0</span> <span class="o">=</span> <span class="n">IOC_STREAM_IDLE</span>
<span class="mi">1</span> <span class="o">=</span> <span class="n">IOC_STREAM_RUNNING</span>
<span class="mi">2</span> <span class="o">=</span> <span class="n">IOC_STREAM_COMPLETED</span>
</pre></div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">iocafe</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction/introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../get-started/get-started.html">Get started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/tutorials.html">Tutorials</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../api-reference.html">API reference</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="api-overviews.html">Overviews</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../security/security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../implementation/implementation.html">Library implementation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../platform-abstraction/platform-abstraction.html">Platform abstraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hw-io-abstraction/hw-io-abstraction.html">Hardware IO abstraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../extensions/extensions.html">Extension libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/dev-tools.html">Development tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../micro-controllers/micro-controllers.html">Micro-controllers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples.html">Example projects</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../api-reference.html">API reference</a><ul>
  <li><a href="api-overviews.html">Overviews</a><ul>
      <li>Previous: <a href="200510-simple-io-device-application-structure.html" title="previous chapter">Simple IO device code structure</a></li>
      <li>Next: <a href="200102-two-directional-memory-blocks.html" title="next chapter">Two dictional memory blocks</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Pekka Lehtikoski, Markku Nissinen.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/api-reference/api-overviews/191206-streaming-data-trough-iocom.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>